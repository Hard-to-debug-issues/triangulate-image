!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.triangulate=e()}(this,function(){"use strict";function t(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function e(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function n(t,e){return e={exports:{}},t(e,e.exports),e.exports}function r(t){var e=new s(t.width,t.height).getContext("2d");return e.putImageData(t,0,0),e.getImageData(0,0,t.width,t.height)}function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function o(t,e,n){var r=t+"|"+e;n[r]||(n[r]={x:t,y:e}),r=null}var i=function(t,e,n){return t<e?e:t>n?n:t},u=function(t){var e=!1;if(void 0!==t)try{e=JSON.parse(JSON.stringify(t))}catch(t){}return e},s=function(t,e){void 0===t&&(t=300),void 0===e&&(e=150),"undefined"==typeof window?(this.canvasEl={width:t,height:e},this.ctx=null):(this.canvasEl=document.createElement("canvas"),this.canvasEl.width=t,this.canvasEl.height=e,this.ctx=this.canvasEl.getContext("2d"))},c={width:{},height:{}};s.prototype.getContext=function(){return this.ctx},s.prototype.toDataURL=function(t,e,n){if("function"!=typeof n)return this.canvasEl.toDataURL(t,e);n(this.canvasEl.toDataURL(t,e))},c.width.get=function(){return this.canvasEl.width},c.width.set=function(t){this.canvasEl.width=t},c.height.get=function(){return this.canvasEl.height},c.height.set=function(t){this.canvasEl.height=t},Object.defineProperties(s.prototype,c),"undefined"!=typeof window&&(s.Image=Image);var l=function(t,e,n,r){var a=!(!e||!e.backgroundColor)&&e.backgroundColor,o=new s(t.width*n,t.height*n,r),i=o.getContext("2d");return a&&(i.fillStyle=a,i.fillRect(0,0,t.width*n,t.height*n),i.fillStyle="transparent"),{canvas:o,ctx:i}},f=function(t){var e=l({width:1,height:1},{},1,!0).ctx;e.fillStyle=t,e.fillRect(0,0,1,1);var n=e.getImageData(0,0,1,1).data;return{r:n[0],g:n[1],b:n[2],a:n[3]/255}},h={accuracy:.7,blur:4,fill:!0,stroke:!0,strokeWidth:.5,lineJoin:"miter",vertexCount:700,threshold:50,transparentColor:!1},d=["miter","round","bevel"],g=function(t){return"object"!=typeof(t=u(t))&&(t={}),"number"!=typeof t.accuracy||isNaN(t.accuracy)?t.accuracy=h.accuracy:t.accuracy=i(t.accuracy,0,1),("number"!=typeof t.blur||isNaN(t.blur))&&(t.blur=h.blur),t.blur<=0&&(t.blur=1),"string"!=typeof t.fill&&"boolean"!=typeof t.fill&&(t.fill=h.fill),"string"!=typeof t.stroke&&"boolean"!=typeof t.stroke&&(t.stroke=h.stroke),("number"!=typeof t.strokeWidth||isNaN(t.strokeWidth))&&(t.strokeWidth=h.strokeWidth),"number"!=typeof t.threshold||isNaN(t.threshold)?t.threshold=h.threshold:t.threshold=i(t.threshold,1,100),"string"==typeof t.lineJoin&&-1!==d.indexOf(t.lineJoin)||(t.lineJoin=h.lineJoin),t.gradients&&t.fill?t.gradients=!0:t.gradients=!1,t.gradients&&(("number"!=typeof t.gradientStops||isNaN(t.gradientStops)||t.gradientStops<2)&&(t.gradientStops=2),t.gradientStops=Math.round(t.gradientStops)),("number"!=typeof t.vertexCount||isNaN(t.vertexCount))&&(t.vertexCount=h.vertexCount),t.vertexCount<=0&&(t.vertexCount=1),"string"!=typeof t.transparentColor&&"boolean"!=typeof t.transparentColor&&(t.transparentColor=h.transparentColor),!0===typeof t.transparentColor&&(t.transparentColor=!1),"string"==typeof t.transparentColor&&(t.transparentColor=f(t.transparentColor)),t},y=function(t){if(t instanceof HTMLImageElement){if(!t.naturalWidth||!t.naturalHeight||!1===t.complete)throw new Error("This this image hasn't finished loading: "+t.src);var e=new s(t.naturalWidth,t.naturalHeight),n=e.getContext("2d");n.drawImage(t,0,0,e.width,e.height);var r=n.getImageData(0,0,e.width,e.height);return r.data&&r.data.length&&(void 0===r.width&&(r.width=t.naturalWidth),void 0===r.height&&(r.height=t.naturalHeight)),r}throw new Error("This object does not seem to be an image.")},p=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable,x=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(t){r[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(e,n){for(var r,a,o=arguments,i=t(e),u=1;u<arguments.length;u++){r=Object(o[u]);for(var s in r)m.call(r,s)&&(i[s]=r[s]);if(p){a=p(r);for(var c=0;c<a.length;c++)v.call(r,a[c])&&(i[a[c]]=r[a[c]])}}return i},b=function(t){var e=x({a:1},t);return"rgba("+e.r+", "+e.g+", "+e.b+", "+e.a+")"},w=function(t,e,n,r){return r=r||1,e.forEach(function(e,n){if(t.beginPath(),t.moveTo(e.a.x*r,e.a.y*r),t.lineTo(e.b.x*r,e.b.y*r),t.lineTo(e.c.x*r,e.c.y*r),t.lineTo(e.a.x*r,e.a.y*r),e.gradient){var a=t.createLinearGradient(e.gradient.x1*r,e.gradient.y1*r,e.gradient.x2*r,e.gradient.y2*r),o=e.gradient.colors.length-1;e.gradient.colors.forEach(function(t,e){var n=b(t);a.addColorStop(e/o,n)}),t.fillStyle=a,t.fill(),e.strokeWidth>0&&(t.strokeStyle=a,t.lineWidth=e.strokeWidth*r,t.lineJoin=e.lineJoin,t.stroke())}else e.fill&&(t.fillStyle=e.fill,t.fill()),e.strokeColor&&(t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeWidth*r,t.lineJoin=e.lineJoin,t.stroke());t.closePath()}),t},k=function(t,e,n){var r=n&&n.dpr?n.dpr:1,a=l(e,n,r,!0).ctx;return w(a,t,0,r),a.getImageData(0,0,e.width*r,e.height*r)},C=function(t,e,n){var r=n&&n.dpr?n.dpr:1,a=l(e,n,r);return w(a.ctx,t,0,r),a.canvas.toDataURL()},_=function(t,e){var n="";t.length&&t[0].gradient&&(n="<defs>");var r="";return t.forEach(function(t,e){var a=t.a,o=t.b,i=t.c;if(r+='<polygon points="'+a.x+","+a.y+" "+o.x+","+o.y+" "+i.x+","+i.y+'"',t.gradient){var u=t.boundingBox,s=((t.gradient.x1-u.x)/u.width*100).toFixed(3),c=((t.gradient.y1-u.y)/u.height*100).toFixed(3),l=((t.gradient.x2-u.x)/u.width*100).toFixed(3),f=((t.gradient.y2-u.y)/u.height*100).toFixed(3);n+='\n\t<linearGradient id="gradient-'+e+'" x1="'+s+'%" y1="'+c+'%" x2="'+l+'%" y2="'+f+'%">';var h=t.gradient.colors.length-1;t.gradient.colors.forEach(function(t,e){var r=b(t),a=(e/h*100).toFixed(3);n+='\n\t\t\t\t\t<stop offset="'+a+'%" stop-color="'+r+'"/>\n\t\t\t\t'}),n+="</linearGradient>",r+=' fill="url(#gradient-'+e+')"',t.strokeWidth>0&&(r+=' stroke="url(#gradient-'+e+')" stroke-width="'+t.strokeWidth+'" stroke-linejoin="'+t.lineJoin+'"')}else t.fill?r+=' fill="'+t.fill+'"':r+=' fill="transparent"',t.strokeColor&&(r+=' stroke="'+t.strokeColor+'" stroke-width="'+t.strokeWidth+'" stroke-linejoin="'+t.lineJoin+'"');r+="/>\n\t"}),n.length&&(n+="\n\t\t</defs>"),'<?xml version="1.0" standalone="yes"?>\n<svg width="'+e.width+'" height="'+e.height+'" xmlns="http://www.w3.org/2000/svg" version="1.1" >\n\t'+n+"\n\t"+r+"\n</svg>"},j="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},E=n(function(t){function e(t,e,n){this.a=t,this.b=e,this.c=n;var r,a,o,i,u=e.x-t.x,s=e.y-t.y,c=n.x-t.x,l=n.y-t.y,f=u*(t.x+e.x)+s*(t.y+e.y),h=c*(t.x+n.x)+l*(t.y+n.y),d=2*(u*(n.y-e.y)-s*(n.x-e.x));Math.abs(d)<1e-6?(r=Math.min(t.x,e.x,n.x),a=Math.min(t.y,e.y,n.y),o=.5*(Math.max(t.x,e.x,n.x)-r),i=.5*(Math.max(t.y,e.y,n.y)-a),this.x=r+o,this.y=a+i,this.r=o*o+i*i):(this.x=(l*f-s*h)/d,this.y=(u*h-c*f)/d,o=this.x-t.x,i=this.y-t.y,this.r=o*o+i*i)}function n(t,e){return e.x-t.x}function r(t){var e,n,r,a,o,i=t.length;t:for(;i;)for(n=t[--i],e=t[--i],r=i;r;)if(o=t[--r],a=t[--r],e===a&&n===o||e===o&&n===a){t.splice(i,2),t.splice(r,2),i-=2;continue t}}function a(t){if(t.length<3)return[];t.sort(n);for(var a=t.length-1,o=t[a].x,i=t[0].x,u=t[a].y,s=u;a--;)t[a].y<u&&(u=t[a].y),t[a].y>s&&(s=t[a].y);var c,l,f,h=i-o,d=s-u,g=h>d?h:d,y=.5*(i+o),p=.5*(s+u),m=[new e({x:y-20*g,y:p-g,__sentinel:!0},{x:y,y:p+20*g,__sentinel:!0},{x:y+20*g,y:p-g,__sentinel:!0})],v=[],x=[];for(a=t.length;a--;){for(x.length=0,c=m.length;c--;)(h=t[a].x-m[c].x)>0&&h*h>m[c].r?(v.push(m[c]),m.splice(c,1)):h*h+(d=t[a].y-m[c].y)*d>m[c].r||(x.push(m[c].a,m[c].b,m[c].b,m[c].c,m[c].c,m[c].a),m.splice(c,1));for(r(x),c=x.length;c;)f=x[--c],l=x[--c],m.push(new e(l,f,t[a]))}for(Array.prototype.push.apply(v,m),a=v.length;a--;)(v[a].a.__sentinel||v[a].b.__sentinel||v[a].c.__sentinel)&&v.splice(a,1);return v}e.prototype.draw=function(t){t.beginPath(),t.moveTo(this.a.x,this.a.y),t.lineTo(this.b.x,this.b.y),t.lineTo(this.c.x,this.c.y),t.closePath(),t.stroke()},t.exports={Triangle:e,triangulate:a}}).triangulate,I=n(function(t,e){!function(n){function r(t){function e(t){return function(e,n,r){return r=r||0,t[4*(o*n+e)+r]}}if(!(this instanceof r))return new r(t);var n,a,o=t.width,i=t.height,u=[[-1,0,1],[-2,0,2],[-1,0,1]],s=[[-1,-2,-1],[0,0,0],[1,2,1]],c=[],l=[],f=e(t.data);for(a=0;a<i;a++)for(n=0;n<o;n++){var h=(f(n,a,0)+f(n,a,1)+f(n,a,2))/3;l.push(h,h,h,255)}for(f=e(l),a=0;a<i;a++)for(n=0;n<o;n++){var d=u[0][0]*f(n-1,a-1)+u[0][1]*f(n,a-1)+u[0][2]*f(n+1,a-1)+u[1][0]*f(n-1,a)+u[1][1]*f(n,a)+u[1][2]*f(n+1,a)+u[2][0]*f(n-1,a+1)+u[2][1]*f(n,a+1)+u[2][2]*f(n+1,a+1),g=s[0][0]*f(n-1,a-1)+s[0][1]*f(n,a-1)+s[0][2]*f(n+1,a-1)+s[1][0]*f(n-1,a)+s[1][1]*f(n,a)+s[1][2]*f(n+1,a)+s[2][0]*f(n-1,a+1)+s[2][1]*f(n,a+1)+s[2][2]*f(n+1,a+1),y=Math.sqrt(d*d+g*g)>>>0;c.push(y,y,y,255)}var p=c;return"function"==typeof Uint8ClampedArray&&(p=new Uint8ClampedArray(c)),p.toImageData=function(){return r.toImageData(p,o,i)},p}function a(t,e,n){return{width:e,height:n,data:t}}r.toImageData=function(t,e,n){if("function"==typeof ImageData&&"[object Uint16Array]"===Object.prototype.toString.call(t))return new ImageData(t,e,n);if("object"==typeof window&&"object"==typeof window.document){var r=document.createElement("canvas");if("function"==typeof r.getContext){var o=r.getContext("2d").createImageData(e,n);return o.data.set(t),o}return new a(t,e,n)}return new a(t,e,n)},t.exports&&(e=t.exports=r),e.Sobel=r}()}),D=function(t){return t&&"number"==typeof t.width&&"number"==typeof t.height&&t.data&&"number"==typeof t.data.length&&"object"==typeof t.data},S=function(t){if(D(t)){if("undefined"==typeof Uint8ClampedArray){if("undefined"==typeof window)throw new Error("Can't copy imageData in webworker without Uint8ClampedArray support.");return r(t)}var e=new Uint8ClampedArray(t.data);if("undefined"==typeof ImageData)return{width:t.width,height:t.height,data:e};var n;try{n=new ImageData(e,t.width,t.height)}catch(e){if("undefined"==typeof window)throw new Error("Can't copy imageData in webworker without proper ImageData() support.");n=r(t)}return n}throw new Error("Given imageData object is not useable.")},O=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],P=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],M=function(t,e,n,r,o,i){var u,s,c,l,f,h,d,g,y,p,m,v,x,b,w,k,C,_,j,E,I,D,S,M,A=t.data,T=i+i+1,V=r-1,J=o-1,G=i+1,N=G*(G+1)/2,W=new a,U=W;for(c=1;c<T;c++)if(U=U.next=new a,c==G)var L=U;U.next=W;var B=null,R=null;d=h=0;var q=O[i],F=P[i];for(s=0;s<o;s++){for(k=C=_=j=g=y=p=m=0,v=G*(E=A[h]),x=G*(I=A[h+1]),b=G*(D=A[h+2]),w=G*(S=A[h+3]),g+=N*E,y+=N*I,p+=N*D,m+=N*S,U=W,c=0;c<G;c++)U.r=E,U.g=I,U.b=D,U.a=S,U=U.next;for(c=1;c<G;c++)l=h+((V<c?V:c)<<2),g+=(U.r=E=A[l])*(M=G-c),y+=(U.g=I=A[l+1])*M,p+=(U.b=D=A[l+2])*M,m+=(U.a=S=A[l+3])*M,k+=E,C+=I,_+=D,j+=S,U=U.next;for(B=W,R=L,u=0;u<r;u++)A[h+3]=S=m*q>>F,0!=S?(S=255/S,A[h]=(g*q>>F)*S,A[h+1]=(y*q>>F)*S,A[h+2]=(p*q>>F)*S):A[h]=A[h+1]=A[h+2]=0,g-=v,y-=x,p-=b,m-=w,v-=B.r,x-=B.g,b-=B.b,w-=B.a,l=d+((l=u+i+1)<V?l:V)<<2,g+=k+=B.r=A[l],y+=C+=B.g=A[l+1],p+=_+=B.b=A[l+2],m+=j+=B.a=A[l+3],B=B.next,v+=E=R.r,x+=I=R.g,b+=D=R.b,w+=S=R.a,k-=E,C-=I,_-=D,j-=S,R=R.next,h+=4;d+=r}for(u=0;u<r;u++){for(C=_=j=k=y=p=m=g=0,v=G*(E=A[h=u<<2]),x=G*(I=A[h+1]),b=G*(D=A[h+2]),w=G*(S=A[h+3]),g+=N*E,y+=N*I,p+=N*D,m+=N*S,U=W,c=0;c<G;c++)U.r=E,U.g=I,U.b=D,U.a=S,U=U.next;for(f=r,c=1;c<=i;c++)h=f+u<<2,g+=(U.r=E=A[h])*(M=G-c),y+=(U.g=I=A[h+1])*M,p+=(U.b=D=A[h+2])*M,m+=(U.a=S=A[h+3])*M,k+=E,C+=I,_+=D,j+=S,U=U.next,c<J&&(f+=r);for(h=u,B=W,R=L,s=0;s<o;s++)A[(l=h<<2)+3]=S=m*q>>F,S>0?(S=255/S,A[l]=(g*q>>F)*S,A[l+1]=(y*q>>F)*S,A[l+2]=(p*q>>F)*S):A[l]=A[l+1]=A[l+2]=0,g-=v,y-=x,p-=b,m-=w,v-=B.r,x-=B.g,b-=B.b,w-=B.a,l=u+((l=s+G)<J?l:J)*r<<2,g+=k+=B.r=A[l],y+=C+=B.g=A[l+1],p+=_+=B.b=A[l+2],m+=j+=B.a=A[l+3],B=B.next,v+=E=R.r,x+=I=R.g,b+=D=R.b,w+=S=R.a,k-=E,C-=I,_-=D,j-=S,R=R.next,h+=r}return t},A=function(t){for(var e,n=t.data.length,r=0;r<n;r+=4)e=.34*t.data[r]+.5*t.data[r+1]+.16*t.data[r+2],t.data[r]=e,t.data[r+1]=e,t.data[r+2]=e;return t},T=function(t,e){var n,r,a,o,i,u,s,c,l,f=t.width,h=t.height,d=t.data,g=[];for(r=0;r<h;r+=2)for(n=0;n<f;n+=2){for(c=l=0,a=-1;a<=1;a++)if(u=r+a,s=u*f,u>=0&&u<h)for(o=-1;o<=1;o++)(i=n+o)>=0&&i<f&&(c+=d[i+s<<2],l++);l&&(c/=l),c>e&&g.push({x:n,y:r})}return g},V=function(t,e,n,r,a){var i={},u=Math.max(~~(e*(1-n)),5),s=Math.round(Math.sqrt(u)),c=~~(r/s),l=~~(a/Math.round(Math.ceil(u/s))),f=0,h=0,d=0;for(d=0;d<a;d+=l)for(h=++f%2==0?~~(c/2):0;h<r;h+=c)h<r&&d<a&&o(~~(h+Math.cos(d)*l),~~(d+Math.sin(h)*c),i);o(0,0,i),o(r-1,0,i),o(r-1,a-1,i),o(0,a-1,i);var g=e-Object.keys(i).length,y=t.length,p=~~(y/g);if(e>0&&p>0){var m=0;for(m=0;m<y;m+=p)o(t[m].x,t[m].y,i)}return t=null,Object.keys(i).map(function(t){return i[t]})},J=function(t){var e=1/0,n=-1/0,r=1/0,a=-1/0;return t.forEach(function(t){t.x<e&&(e=t.x),t.y<r&&(r=t.y),t.x>n&&(n=t.x),t.y>a&&(a=t.y)}),{x:e,y:r,width:n-e,height:a-r}},G=function(t,e,n){return t.forEach(function(t){t.boundingBox=J([t.a,t.b,t.c])}),t.filter(function(t){return t.boundingBox.width>0&&t.boundingBox.height>0})},N=function(t,e,n){var r=(0|i(t.x,1,e.width-2))+(0|i(t.y,1,e.height-2))*e.width<<2;r>=e.data.length&&(r=e.data.length-5);var a=e.data[r+3]/255;return n&&0===a?n:{r:e.data[r],g:e.data[r+1],b:e.data[r+2],a:a}},W=function(t){return{x:.33333*(t.a.x+t.b.x+t.c.x),y:.33333*(t.a.y+t.b.y+t.c.y)}},U=function(t){return 0===t.a},L=function(t,e,n){var r=n.fill,a=n.stroke,o=n.strokeWidth,i=n.lineJoin,u=n.transparentColor,s="string"==typeof r&&r,c="string"==typeof a&&a,l=function(t,e){var n=U(t)&&u,r=n?u:t;return e&&!n?e:b(r)};return t.forEach(function(t){var n=N(W(t),e);r&&(t.fill=l(n,s)),a&&(t.strokeColor=l(n,c),t.strokeWidth=o,t.lineJoin=i)}),t},B=function(t){var e=[t.r,t.g,t.b].map(function(t){return t/=255,t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)});return.2126*e[0]+.7152*e[1]+.0722*e[2]},R=function(t,e){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},q=function(t,e,n){return t.forEach(function(t){var r={};"abc".split("").forEach(function(a){var o=N(t[a],e,n.transparentColor);r[a]={key:a,color:o,x:t[a].x,y:t[a].y},r[a].luminance=B(r[a].color);var i="abc".replace(a,"").split("");r[a].median={x:(t[i[0]].x+t[i[1]].x)/2,y:(t[i[0]].y+t[i[1]].y)/2},r[a].medianColor=N(r[a].median,e,n.transparentColor),r[a].medianLuminance=B(r[a].medianColor)});for(var a=[r.a,r.b,r.c].sort(function(t,e){return Math.abs(t.luminance-t.medianLuminance)-Math.abs(e.luminance-e.medianLuminance)}),o=a[0],i=a[0],u=o.median,s=[i],c=R(i,u),l=1,f=n.gradientStops-2;l<f;l++){var h=l*(c/n.gradientStops)/c,d={x:i.x+h*(u.x-i.x),y:i.y+h*(u.y-i.y)};s.push(d)}s.push(u),t.gradient={x1:o.x,y1:o.y,x2:o.median.x,y2:o.median.y,colors:s.map(function(t){return N(t,e,n.transparentColor)})},n.stroke&&(t.strokeWidth=n.strokeWidth,t.lineJoin=n.lineJoin),r=null}),t},F=function(t,e){return t.filter(function(t){var n=N(W(t),e);return!U(n)})},H=function(t,e){if(D(t)){var n={width:t.width,height:t.height},r=S(t),a=S(t),o=M(r,0,0,n.width,n.height,e.blur),i=A(o),u=I(i).toImageData(),s=T(u,e.threshold),c=V(s,e.vertexCount,e.accuracy,n.width,n.height),l=E(c);return l=G(l),e.transparentColor||(l=F(l,a)),l=!0===e.fill&&!0===e.gradients?q(l,a,e):L(l,a,e)}throw new Error("Can't work with the imageData provided. It seems to be corrupt.")};return n(function(t,n){!function(n,r){t.exports=function(){function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function n(t){return"function"==typeof t}function r(t){q=t}function a(t){F=t}function o(){return void 0!==R?function(){R(u)}:i()}function i(){var t=setTimeout;return function(){return t(u,1)}}function u(){for(var t=0;t<B;t+=2)(0,Q[t])(Q[t+1]),Q[t]=void 0,Q[t+1]=void 0;B=0}function s(t,e){var n=arguments,r=this,a=new this.constructor(l);void 0===a[Z]&&O(a);var o=r._state;return o?function(){var t=n[o-1];F(function(){return I(o,a,t,r._result)})}():k(r,a,t,e),a}function c(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(l);return v(n,t),n}function l(){}function f(){return new TypeError("You cannot resolve a promise with itself")}function h(){return new TypeError("A promises callback cannot return that same promise.")}function d(t){try{return t.then}catch(t){return rt.error=t,rt}}function g(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}function y(t,e,n){F(function(t){var r=!1,a=g(n,e,function(n){r||(r=!0,e!==n?v(t,n):b(t,n))},function(e){r||(r=!0,w(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&a&&(r=!0,w(t,a))},t)}function p(t,e){e._state===et?b(t,e._result):e._state===nt?w(t,e._result):k(e,void 0,function(e){return v(t,e)},function(e){return w(t,e)})}function m(t,e,r){e.constructor===t.constructor&&r===s&&e.constructor.resolve===c?p(t,e):r===rt?(w(t,rt.error),rt.error=null):void 0===r?b(t,e):n(r)?y(t,e,r):b(t,e)}function v(e,n){e===n?w(e,f()):t(n)?m(e,n,d(n)):b(e,n)}function x(t){t._onerror&&t._onerror(t._result),C(t)}function b(t,e){t._state===tt&&(t._result=e,t._state=et,0!==t._subscribers.length&&F(C,t))}function w(t,e){t._state===tt&&(t._state=nt,t._result=e,F(x,t))}function k(t,e,n,r){var a=t._subscribers,o=a.length;t._onerror=null,a[o]=e,a[o+et]=n,a[o+nt]=r,0===o&&t._state&&F(C,t)}function C(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,a=void 0,o=t._result,i=0;i<e.length;i+=3)r=e[i],a=e[i+n],r?I(n,r,a,o):a(o);t._subscribers.length=0}}function _(){this.error=null}function E(t,e){try{return t(e)}catch(t){return at.error=t,at}}function I(t,e,r,a){var o=n(r),i=void 0,u=void 0,s=void 0,c=void 0;if(o){if(i=E(r,a),i===at?(c=!0,u=i.error,i.error=null):s=!0,e===i)return void w(e,h())}else i=a,s=!0;e._state!==tt||(o&&s?v(e,i):c?w(e,u):t===et?b(e,i):t===nt&&w(e,i))}function D(t,e){try{e(function(e){v(t,e)},function(e){w(t,e)})}catch(e){w(t,e)}}function S(){return ot++}function O(t){t[Z]=ot++,t._state=void 0,t._result=void 0,t._subscribers=[]}function P(t,e){this._instanceConstructor=t,this.promise=new t(l),this.promise[Z]||O(this.promise),L(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?b(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&b(this.promise,this._result))):w(this.promise,M())}function M(){return new Error("Array Methods must be provided an Array")}function A(t){return new P(this,t).promise}function T(t){var e=this;return new e(L(t)?function(n,r){for(var a=t.length,o=0;o<a;o++)e.resolve(t[o]).then(n,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function V(t){var e=new this(l);return w(e,t),e}function J(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function G(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function N(t){this[Z]=S(),this._result=this._state=void 0,this._subscribers=[],l!==t&&("function"!=typeof t&&J(),this instanceof N?D(this,t):G())}function W(){var t=void 0;if(void 0!==j)t=j;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=N}var U=void 0,L=U=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},B=0,R=void 0,q=void 0,F=function(t,e){Q[B]=t,Q[B+1]=e,2===(B+=2)&&(q?q(u):X())},H="undefined"!=typeof window?window:void 0,$=H||{},Y=$.MutationObserver||$.WebKitMutationObserver,K="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),z="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Q=new Array(1e3),X=void 0;X=K?function(){return function(){return process.nextTick(u)}}():Y?function(){var t=0,e=new Y(u),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}():z?function(){var t=new MessageChannel;return t.port1.onmessage=u,function(){return t.port2.postMessage(0)}}():void 0===H&&"function"==typeof e?function(){try{var t=e("vertx");return R=t.runOnLoop||t.runOnContext,o()}catch(t){return i()}}():i();var Z=Math.random().toString(36).substring(16),tt=void 0,et=1,nt=2,rt=new _,at=new _,ot=0;return P.prototype._enumerate=function(){for(var t=this,e=this.length,n=this._input,r=0;this._state===tt&&r<e;r++)t._eachEntry(n[r],r)},P.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===c){var a=d(t);if(a===s&&t._state!==tt)this._settledAt(t._state,e,t._result);else if("function"!=typeof a)this._remaining--,this._result[e]=t;else if(n===N){var o=new n(l);m(o,t,a),this._willSettleAt(o,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},P.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===tt&&(this._remaining--,t===nt?w(r,n):this._result[e]=n),0===this._remaining&&b(r,this._result)},P.prototype._willSettleAt=function(t,e){var n=this;k(t,void 0,function(t){return n._settledAt(et,e,t)},function(t){return n._settledAt(nt,e,t)})},N.all=A,N.race=T,N.resolve=c,N.reject=V,N._setScheduler=r,N._setAsap=a,N._asap=F,N.prototype={constructor:N,then:s,catch:function(t){return this.then(null,t)}},N.polyfill=W,N.Promise=N,N}()}()}).polyfill(),function(t){function e(){return t}function n(){var t=x({},T);return S||x(t,V),t}function r(){var t=x({},T);return O||x(t,J),t}function a(t){return v(y,t)}function o(t){return v(y,t,!0)}function i(t){return v(function(t){return t},t)}function u(t){return v(function(t){return t},t,!0)}function s(t){return b(function(t){return t},t)}function c(t){return b(function(t){return t},t,!0)}function l(t){return b(C,t)}function f(t){return b(C,t,!0)}function h(t){return b(k,t)}function d(t){return b(k,t,!0)}function p(t){return b(_,t)}function m(t){return b(_,t,!0)}function v(t,e,n){return P=!!n,S=function(){return P?t(e):new Promise(function(n,r){try{n(t(e))}catch(t){r(t)}})},w()?j():r()}function b(t,e,r){return M=!!r,O=function(n,r){return M?t(n,r,e):new Promise(function(a,o){try{a(t(n,r,e))}catch(t){o(t)}})},w()?j():n()}function w(){return S&&O}function j(){if(P&&M){var e=S(t),n=H(e,t);return O(n,e)}return new Promise(function(e,n){var r;E().then(function(e){return r=e,I(r,t)},n).then(function(t){return D(t,r)},n).then(function(t){e(t)},n)})}function E(t){return new Promise(function(e,n){if(P)try{e(S(t))}catch(t){n(t)}else S(t).then(e,n)})}function I(t,e){return new Promise(function(n,r){A.addEventListener("message",function(t){if(t.data&&t.data.polygonJSONStr){var e=JSON.parse(t.data.polygonJSONStr);n(e)}else r(t.data&&t.data.err?t.data.err:t)}),A.postMessage({params:e,imageData:t,imageDataWidth:t.width,imageDataHeight:t.height})})}function D(t,e){return new Promise(function(n,r){if(M)try{n(O(t,e))}catch(t){r(t)}else O(t,e).then(n,r)})}t=g(t);var S,O,P=!1,M=!1,A=new Worker(URL.createObjectURL(new Blob(['function createCommonjsModule(t,e){return e={exports:{}},t(e,e.exports),e.exports}function copyImageDataWithCanvas(t){var e=new Canvas$1(t.width,t.height).getContext("2d");return e.putImageData(t,0,0),e.getImageData(0,0,t.width,t.height)}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function addVertex(t,e,a){var n=t+"|"+e;a[n]||(a[n]={x:t,y:e}),n=null}function toObject(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function shouldUseNative(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},a=0;a<10;a++)e["_"+String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},delaunay=createCommonjsModule(function(t){function e(t,e,a){this.a=t,this.b=e,this.c=a;var n,r,o,i,s=e.x-t.x,c=e.y-t.y,u=a.x-t.x,h=a.y-t.y,l=s*(t.x+e.x)+c*(t.y+e.y),d=u*(t.x+a.x)+h*(t.y+a.y),f=2*(s*(a.y-e.y)-c*(a.x-e.x));Math.abs(f)<1e-6?(n=Math.min(t.x,e.x,a.x),r=Math.min(t.y,e.y,a.y),o=.5*(Math.max(t.x,e.x,a.x)-n),i=.5*(Math.max(t.y,e.y,a.y)-r),this.x=n+o,this.y=r+i,this.r=o*o+i*i):(this.x=(h*l-c*d)/f,this.y=(s*d-u*l)/f,o=this.x-t.x,i=this.y-t.y,this.r=o*o+i*i)}function a(t,e){return e.x-t.x}function n(t){var e,a,n,r,o,i=t.length;t:for(;i;)for(a=t[--i],e=t[--i],n=i;n;)if(o=t[--n],r=t[--n],e===r&&a===o||e===o&&a===r){t.splice(i,2),t.splice(n,2),i-=2;continue t}}function r(t){if(t.length<3)return[];t.sort(a);for(var r=t.length-1,o=t[r].x,i=t[0].x,s=t[r].y,c=s;r--;)t[r].y<s&&(s=t[r].y),t[r].y>c&&(c=t[r].y);var u,h,l,d=i-o,f=c-s,g=d>f?d:f,y=.5*(i+o),p=.5*(c+s),m=[new e({x:y-20*g,y:p-g,__sentinel:!0},{x:y,y:p+20*g,__sentinel:!0},{x:y+20*g,y:p-g,__sentinel:!0})],x=[],b=[];for(r=t.length;r--;){for(b.length=0,u=m.length;u--;)(d=t[r].x-m[u].x)>0&&d*d>m[u].r?(x.push(m[u]),m.splice(u,1)):d*d+(f=t[r].y-m[u].y)*f>m[u].r||(b.push(m[u].a,m[u].b,m[u].b,m[u].c,m[u].c,m[u].a),m.splice(u,1));for(n(b),u=b.length;u;)l=b[--u],h=b[--u],m.push(new e(h,l,t[r]))}for(Array.prototype.push.apply(x,m),r=x.length;r--;)(x[r].a.__sentinel||x[r].b.__sentinel||x[r].c.__sentinel)&&x.splice(r,1);return x}e.prototype.draw=function(t){t.beginPath(),t.moveTo(this.a.x,this.a.y),t.lineTo(this.b.x,this.b.y),t.lineTo(this.c.x,this.c.y),t.closePath(),t.stroke()},t.exports={Triangle:e,triangulate:r}}),delaunay_2=delaunay.triangulate,sobel=createCommonjsModule(function(t,e){!function(a){"use strict";function n(t){function e(t){return function(e,a,n){return n=n||0,t[4*(o*a+e)+n]}}if(!(this instanceof n))return new n(t);var a,r,o=t.width,i=t.height,s=[[-1,0,1],[-2,0,2],[-1,0,1]],c=[[-1,-2,-1],[0,0,0],[1,2,1]],u=[],h=[],l=e(t.data);for(r=0;r<i;r++)for(a=0;a<o;a++){var d=(l(a,r,0)+l(a,r,1)+l(a,r,2))/3;h.push(d,d,d,255)}for(l=e(h),r=0;r<i;r++)for(a=0;a<o;a++){var f=s[0][0]*l(a-1,r-1)+s[0][1]*l(a,r-1)+s[0][2]*l(a+1,r-1)+s[1][0]*l(a-1,r)+s[1][1]*l(a,r)+s[1][2]*l(a+1,r)+s[2][0]*l(a-1,r+1)+s[2][1]*l(a,r+1)+s[2][2]*l(a+1,r+1),g=c[0][0]*l(a-1,r-1)+c[0][1]*l(a,r-1)+c[0][2]*l(a+1,r-1)+c[1][0]*l(a-1,r)+c[1][1]*l(a,r)+c[1][2]*l(a+1,r)+c[2][0]*l(a-1,r+1)+c[2][1]*l(a,r+1)+c[2][2]*l(a+1,r+1),y=Math.sqrt(f*f+g*g)>>>0;u.push(y,y,y,255)}var p=u;return"function"==typeof Uint8ClampedArray&&(p=new Uint8ClampedArray(u)),p.toImageData=function(){return n.toImageData(p,o,i)},p}function r(t,e,a){return{width:e,height:a,data:t}}n.toImageData=function(t,e,a){if("function"==typeof ImageData&&"[object Uint16Array]"===Object.prototype.toString.call(t))return new ImageData(t,e,a);if("object"==typeof window&&"object"==typeof window.document){var n=document.createElement("canvas");if("function"==typeof n.getContext){var o=n.getContext("2d").createImageData(e,a);return o.data.set(t),o}return new r(t,e,a)}return new r(t,e,a)},t.exports&&(e=t.exports=n),e.Sobel=n}()}),isImageData=function(t){return t&&"number"==typeof t.width&&"number"==typeof t.height&&t.data&&"number"==typeof t.data.length&&"object"==typeof t.data},Canvas$1=function(t,e){void 0===t&&(t=300),void 0===e&&(e=150),"undefined"==typeof window?(this.canvasEl={width:t,height:e},this.ctx=null):(this.canvasEl=document.createElement("canvas"),this.canvasEl.width=t,this.canvasEl.height=e,this.ctx=this.canvasEl.getContext("2d"))},prototypeAccessors={width:{},height:{}};Canvas$1.prototype.getContext=function(){return this.ctx},Canvas$1.prototype.toDataURL=function(t,e,a){if("function"!=typeof a)return this.canvasEl.toDataURL(t,e);a(this.canvasEl.toDataURL(t,e))},prototypeAccessors.width.get=function(){return this.canvasEl.width},prototypeAccessors.width.set=function(t){this.canvasEl.width=t},prototypeAccessors.height.get=function(){return this.canvasEl.height},prototypeAccessors.height.set=function(t){this.canvasEl.height=t},Object.defineProperties(Canvas$1.prototype,prototypeAccessors),"undefined"!=typeof window&&(Canvas$1.Image=Image);var copyImageData=function(t){if(isImageData(t)){if("undefined"==typeof Uint8ClampedArray){if("undefined"==typeof window)throw new Error("Can\'t copy imageData in webworker without Uint8ClampedArray support.");return copyImageDataWithCanvas(t)}var e=new Uint8ClampedArray(t.data);if("undefined"==typeof ImageData)return{width:t.width,height:t.height,data:e};var a;try{a=new ImageData(e,t.width,t.height)}catch(e){if("undefined"==typeof window)throw new Error("Can\'t copy imageData in webworker without proper ImageData() support.");a=copyImageDataWithCanvas(t)}return a}throw new Error("Given imageData object is not useable.")},mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24],stackblur=function(t,e,a,n,r,o){var i,s,c,u,h,l,d,f,g,y,p,m,x,b,w,v,C,D,P,j,E,O,I,M,k=t.data,B=o+o+1,_=n-1,T=r-1,S=o+1,A=S*(S+1)/2,U=new BlurStack,V=U;for(c=1;c<B;c++)if(V=V.next=new BlurStack,c==S)var W=V;V.next=U;var G=null,J=null;d=l=0;var L=mul_table[o],N=shg_table[o];for(s=0;s<r;s++){for(v=C=D=P=f=g=y=p=0,m=S*(j=k[l]),x=S*(E=k[l+1]),b=S*(O=k[l+2]),w=S*(I=k[l+3]),f+=A*j,g+=A*E,y+=A*O,p+=A*I,V=U,c=0;c<S;c++)V.r=j,V.g=E,V.b=O,V.a=I,V=V.next;for(c=1;c<S;c++)u=l+((_<c?_:c)<<2),f+=(V.r=j=k[u])*(M=S-c),g+=(V.g=E=k[u+1])*M,y+=(V.b=O=k[u+2])*M,p+=(V.a=I=k[u+3])*M,v+=j,C+=E,D+=O,P+=I,V=V.next;for(G=U,J=W,i=0;i<n;i++)k[l+3]=I=p*L>>N,0!=I?(I=255/I,k[l]=(f*L>>N)*I,k[l+1]=(g*L>>N)*I,k[l+2]=(y*L>>N)*I):k[l]=k[l+1]=k[l+2]=0,f-=m,g-=x,y-=b,p-=w,m-=G.r,x-=G.g,b-=G.b,w-=G.a,u=d+((u=i+o+1)<_?u:_)<<2,f+=v+=G.r=k[u],g+=C+=G.g=k[u+1],y+=D+=G.b=k[u+2],p+=P+=G.a=k[u+3],G=G.next,m+=j=J.r,x+=E=J.g,b+=O=J.b,w+=I=J.a,v-=j,C-=E,D-=O,P-=I,J=J.next,l+=4;d+=n}for(i=0;i<n;i++){for(C=D=P=v=g=y=p=f=0,m=S*(j=k[l=i<<2]),x=S*(E=k[l+1]),b=S*(O=k[l+2]),w=S*(I=k[l+3]),f+=A*j,g+=A*E,y+=A*O,p+=A*I,V=U,c=0;c<S;c++)V.r=j,V.g=E,V.b=O,V.a=I,V=V.next;for(h=n,c=1;c<=o;c++)l=h+i<<2,f+=(V.r=j=k[l])*(M=S-c),g+=(V.g=E=k[l+1])*M,y+=(V.b=O=k[l+2])*M,p+=(V.a=I=k[l+3])*M,v+=j,C+=E,D+=O,P+=I,V=V.next,c<T&&(h+=n);for(l=i,G=U,J=W,s=0;s<r;s++)k[(u=l<<2)+3]=I=p*L>>N,I>0?(I=255/I,k[u]=(f*L>>N)*I,k[u+1]=(g*L>>N)*I,k[u+2]=(y*L>>N)*I):k[u]=k[u+1]=k[u+2]=0,f-=m,g-=x,y-=b,p-=w,m-=G.r,x-=G.g,b-=G.b,w-=G.a,u=i+((u=s+S)<T?u:T)*n<<2,f+=v+=G.r=k[u],g+=C+=G.g=k[u+1],y+=D+=G.b=k[u+2],p+=P+=G.a=k[u+3],G=G.next,m+=j=J.r,x+=E=J.g,b+=O=J.b,w+=I=J.a,v-=j,C-=E,D-=O,P-=I,J=J.next,l+=n}return t},greyscale=function(t){for(var e,a=t.data.length,n=0;n<a;n+=4)e=.34*t.data[n]+.5*t.data[n+1]+.16*t.data[n+2],t.data[n]=e,t.data[n+1]=e,t.data[n+2]=e;return t},getEdgePoints=function(t,e){var a,n,r,o,i,s,c,u,h,l=t.width,d=t.height,f=t.data,g=[];for(n=0;n<d;n+=2)for(a=0;a<l;a+=2){for(u=h=0,r=-1;r<=1;r++)if(s=n+r,c=s*l,s>=0&&s<d)for(o=-1;o<=1;o++)(i=a+o)>=0&&i<l&&(u+=f[i+c<<2],h++);h&&(u/=h),u>e&&g.push({x:a,y:n})}return g},clamp=function(t,e,a){return t<e?e:t>a?a:t},getVerticesFromPoints=function(t,e,a,n,r){var o={},i=Math.max(~~(e*(1-a)),5),s=Math.round(Math.sqrt(i)),c=~~(n/s),u=~~(r/Math.round(Math.ceil(i/s))),h=0,l=0,d=0;for(d=0;d<r;d+=u)for(l=++h%2==0?~~(c/2):0;l<n;l+=c)l<n&&d<r&&addVertex(~~(l+Math.cos(d)*u),~~(d+Math.sin(l)*c),o);addVertex(0,0,o),addVertex(n-1,0,o),addVertex(n-1,r-1,o),addVertex(0,r-1,o);var f=e-Object.keys(o).length,g=t.length,y=~~(g/f);if(e>0&&y>0){var p=0;for(p=0;p<g;p+=y)addVertex(t[p].x,t[p].y,o)}return t=null,Object.keys(o).map(function(t){return o[t]})},getBoundingBox=function(t){var e=1/0,a=-1/0,n=1/0,r=-1/0;return t.forEach(function(t){t.x<e&&(e=t.x),t.y<n&&(n=t.y),t.x>a&&(a=t.x),t.y>r&&(r=t.y)}),{x:e,y:n,width:a-e,height:r-n}},addBoundingBoxesToPolygons=function(t,e,a){return t.forEach(function(t){t.boundingBox=getBoundingBox([t.a,t.b,t.c])}),t.filter(function(t){return t.boundingBox.width>0&&t.boundingBox.height>0})},getColorByPos=function(t,e,a){var n=(0|clamp(t.x,1,e.width-2))+(0|clamp(t.y,1,e.height-2))*e.width<<2;n>=e.data.length&&(n=e.data.length-5);var r=e.data[n+3]/255;return a&&0===r?a:{r:e.data[n],g:e.data[n+1],b:e.data[n+2],a:r}},polygonCenter=function(t){return{x:.33333*(t.a.x+t.b.x+t.c.x),y:.33333*(t.a.y+t.b.y+t.c.y)}},isTransparent=function(t){return 0===t.a},getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable,index=shouldUseNative()?Object.assign:function(t,e){for(var a,n,r=arguments,o=toObject(t),i=1;i<arguments.length;i++){a=Object(r[i]);for(var s in a)hasOwnProperty.call(a,s)&&(o[s]=a[s]);if(getOwnPropertySymbols){n=getOwnPropertySymbols(a);for(var c=0;c<n.length;c++)propIsEnumerable.call(a,n[c])&&(o[n[c]]=a[n[c]])}}return o},toRGBA=function(t){var e=index({a:1},t);return"rgba("+e.r+", "+e.g+", "+e.b+", "+e.a+")"},addColorToPolygons=function(t,e,a){var n=a.fill,r=a.stroke,o=a.strokeWidth,i=a.lineJoin,s=a.transparentColor,c="string"==typeof n&&n,u="string"==typeof r&&r,h=function(t,e){var a=isTransparent(t)&&s,n=a?s:t;return e&&!a?e:toRGBA(n)};return t.forEach(function(t){var a=getColorByPos(polygonCenter(t),e);n&&(t.fill=h(a,c)),r&&(t.strokeColor=h(a,u),t.strokeWidth=o,t.lineJoin=i)}),t},luminance=function(t){var e=[t.r,t.g,t.b].map(function(t){return t/=255,t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)});return.2126*e[0]+.7152*e[1]+.0722*e[2]},distance=function(t,e){var a=e.x-t.x,n=e.y-t.y;return Math.sqrt(a*a+n*n)},addGradientsToPolygons=function(t,e,a){return t.forEach(function(t){var n={};"abc".split("").forEach(function(r){var o=getColorByPos(t[r],e,a.transparentColor);n[r]={key:r,color:o,x:t[r].x,y:t[r].y},n[r].luminance=luminance(n[r].color);var i="abc".replace(r,"").split("");n[r].median={x:(t[i[0]].x+t[i[1]].x)/2,y:(t[i[0]].y+t[i[1]].y)/2},n[r].medianColor=getColorByPos(n[r].median,e,a.transparentColor),n[r].medianLuminance=luminance(n[r].medianColor)});for(var r=[n.a,n.b,n.c].sort(function(t,e){return Math.abs(t.luminance-t.medianLuminance)-Math.abs(e.luminance-e.medianLuminance)}),o=r[0],i=r[0],s=o.median,c=[i],u=distance(i,s),h=1,l=a.gradientStops-2;h<l;h++){var d=h*(u/a.gradientStops)/u,f={x:i.x+d*(s.x-i.x),y:i.y+d*(s.y-i.y)};c.push(f)}c.push(s),t.gradient={x1:o.x,y1:o.y,x2:o.median.x,y2:o.median.y,colors:c.map(function(t){return getColorByPos(t,e,a.transparentColor)})},a.stroke&&(t.strokeWidth=a.strokeWidth,t.lineJoin=a.lineJoin),n=null}),t},filterTransparentPolygons=function(t,e){return t.filter(function(t){var a=getColorByPos(polygonCenter(t),e);return!isTransparent(a)})},imageDataToPolygons=function(t,e){if(isImageData(t)){var a={width:t.width,height:t.height},n=copyImageData(t),r=copyImageData(t),o=stackblur(n,0,0,a.width,a.height,e.blur),i=greyscale(o),s=sobel(i).toImageData(),c=getEdgePoints(s,e.threshold),u=getVerticesFromPoints(c,e.vertexCount,e.accuracy,a.width,a.height),h=delaunay_2(u);return h=addBoundingBoxesToPolygons(h),e.transparentColor||(h=filterTransparentPolygons(h,r)),h=!0===e.fill&&!0===e.gradients?addGradientsToPolygons(h,r,e):addColorToPolygons(h,r,e)}throw new Error("Can\'t work with the imageData provided. It seems to be corrupt.")};onmessage=function(t){if(t.data.imageData&&t.data.params)try{var e=t.data.imageData;void 0===e.width&&"number"==typeof t.data.imageDataWidth&&(e.width=t.data.imageDataWidth),void 0===e.height&&"number"==typeof t.data.imageDataHeight&&(e.height=t.data.imageDataHeight);var a=imageDataToPolygons(t.data.imageData,t.data.params);self.postMessage({polygonJSONStr:JSON.stringify(a)})}catch(t){self.postMessage({err:t.message||t})}else t.data.imageData?self.postMessage({err:"Parameters are missing."}):self.postMessage({err:"ImageData is missing."});self.close()};'],{type:"text/javascript"}))),T={getParams:e,getInput:n,getOutput:r},V={fromImage:a,fromImageSync:o,fromImageData:i,fromImageDataSync:u},J={toData:s,toDataSync:c,toDataURL:l,toDataURLSync:f,toImageData:h,toImageDataSync:d,toSVG:p,toSVGSync:m};return n()}});